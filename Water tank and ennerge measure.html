<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´ç®±ç‰©ç†éªŒè¯+èƒ½è€—åˆ†æç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 36px;
            margin-bottom: 15px;
        }
        .tank-specs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 25px;
        }
        .spec-card {
            background: rgba(255,255,255,0.15);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.4);
        }
        .spec-card h3 {
            margin-bottom: 15px;
            font-size: 22px;
        }
        .spec-card p {
            font-size: 16px;
            line-height: 1.8;
        }
        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 3px solid #ddd;
            flex-wrap: wrap;
        }
        .tab {
            flex: 1;
            min-width: 180px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            background: #f5f5f5;
            font-size: 15px;
        }
        .tab:hover {
            background: #e0e0e0;
        }
        .tab.active {
            background: white;
            border-bottom: 4px solid #2c5364;
            color: #2c5364;
        }
        .content {
            padding: 35px;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .dual-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        @media (max-width: 1400px) {
            .dual-panel {
                grid-template-columns: 1fr;
            }
        }
        .panel {
            border: 3px solid #ddd;
            border-radius: 15px;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        .panel.small-station {
            border-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }
        .panel.large-station {
            border-color: #007bff;
            background: linear-gradient(135deg, #cce5ff 0%, #b8daff 100%);
        }
        .panel h3 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 24px;
            padding: 15px;
            border-radius: 10px;
        }
        .panel.small-station h3 {
            background: #28a745;
            color: white;
        }
        .panel.large-station h3 {
            background: #007bff;
            color: white;
        }
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .input-wrapper {
            display: flex;
            flex-direction: column;
        }
        .input-wrapper.full-width {
            grid-column: 1 / -1;
        }
        .input-wrapper label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .required {
            color: #dc3545;
            font-size: 16px;
        }
        .input-wrapper input, .input-wrapper select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }
        .input-wrapper input:focus, .input-wrapper select:focus {
            outline: none;
            border-color: #2c5364;
            box-shadow: 0 0 0 3px rgba(44, 83, 100, 0.1);
        }
        button {
            background: linear-gradient(135deg, #0f2027 0%, #2c5364 100%);
            color: white;
            padding: 14px 35px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(44, 83, 100, 0.5);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
        }
        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }
        .btn-purple {
            background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
        }
        .alert {
            padding: 18px;
            border-radius: 10px;
            margin: 18px 0;
            font-weight: 500;
            font-size: 15px;
            line-height: 1.8;
        }
        .alert-warning {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            color: #856404;
        }
        .alert-danger {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
            color: #721c24;
        }
        .alert-success {
            background: #d4edda;
            border-left: 5px solid #28a745;
            color: #155724;
        }
        .alert-info {
            background: #d1ecf1;
            border-left: 5px solid #17a2b8;
            color: #0c5460;
        }
        .result-card {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 25px 0;
            border: 3px solid #4caf50;
        }
        .result-card.energy {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-color: #ff9800;
        }
        .result-card h3 {
            color: #2e7d32;
            margin-bottom: 20px;
            font-size: 22px;
        }
        .result-card.energy h3 {
            color: #e65100;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            margin: 12px 0;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .result-item span:first-child {
            color: #555;
            font-size: 16px;
        }
        .result-item span:last-child {
            color: #2c5364;
            font-size: 20px;
        }
        .formula-box {
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border: 3px solid #fbc02d;
        }
        .formula-box h4 {
            color: #f57f17;
            margin-bottom: 20px;
            font-size: 20px;
        }
        .formula-box code {
            background: white;
            padding: 12px 20px;
            border-radius: 8px;
            display: block;
            margin: 10px 0;
            font-size: 15px;
            border: 2px solid #fdd835;
            font-weight: 600;
            color: #333;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            display: block;
            max-height: 600px;
            overflow: auto;
        }
        .data-table thead {
            background: #2c5364;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .data-table th, .data-table td {
            padding: 14px;
            text-align: center;
            border: 1px solid #ddd;
            white-space: nowrap;
        }
        .data-table tbody tr:hover {
            background: #f0f0f0;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 3px solid #e0e0e0;
            text-align: center;
            transition: all 0.3s;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .metric-card h4 {
            margin-bottom: 15px;
            font-size: 16px;
            color: #666;
        }
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            margin: 15px 0;
            color: #2c5364;
        }
        .metric-card.highlight {
            border-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }
        .metric-card.highlight .metric-value {
            color: #28a745;
        }
        .metric-card.energy-highlight {
            border-color: #ff9800;
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
        }
        .metric-card.energy-highlight .metric-value {
            color: #e65100;
        }
        .deviation-badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-top: 10px;
        }
        .deviation-good {
            background: #d4edda;
            color: #155724;
        }
        .deviation-warning {
            background: #fff3cd;
            color: #856404;
        }
        .deviation-danger {
            background: #f8d7da;
            color: #721c24;
        }
        .delete-btn {
            background: #dc3545;
            padding: 6px 14px;
            font-size: 13px;
        }
        .highlight-number {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        .section-divider {
            border-top: 2px dashed #dee2e6;
            margin: 25px 0;
            padding-top: 20px;
        }
        .temp-badge {
            background: #17a2b8;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 13px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¬ æ°´ç®±ç‰©ç†éªŒè¯ + èƒ½è€—åˆ†æç³»ç»Ÿ v4.0</h1>
            <p style="font-size: 20px; margin-top: 10px;">
                <strong>åŒé‡éªŒè¯ï¼š</strong>ç‰©ç†å®¹é‡éªŒè¯è®¾å¤‡å‡†ç¡®æ€§ + å•ä½èƒ½è€—åˆ†æåŠ çƒ­æ•ˆç‡
            </p>
            
            <div class="tank-specs">
                <div class="spec-card">
                    <h3>ğŸŸ¢ 40å¨å°èƒ½æºç«™</h3>
                    <p>ğŸ“ åº•é¢ç§¯ï¼š<strong>16 mÂ²</strong></p>
                    <p>ğŸ“ æ ‡ç§°å®¹é‡ï¼š40 å¨</p>
                    <p>âš¡ æ ‡ç§°è¡¥æ°´é€Ÿåº¦ï¼š10.5 å¨/æ—¶</p>
                    <p>ğŸ”¥ åŠ çƒ­æ–¹å¼ï¼šç”µåŠ çƒ­</p>
                </div>
                <div class="spec-card">
                    <h3>ğŸ”µ 120å¨å¤§èƒ½æºç«™</h3>
                    <p>ğŸ“ åº•é¢ç§¯ï¼š<strong>40 mÂ²</strong></p>
                    <p>ğŸ“ æ ‡ç§°å®¹é‡ï¼š120 å¨</p>
                    <p>âš¡ æ ‡ç§°è¡¥æ°´é€Ÿåº¦ï¼š18 å¨/æ—¶</p>
                    <p>ğŸ”¥ åŠ çƒ­æ–¹å¼ï¼šç”µåŠ çƒ­</p>
                </div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab(0)">ğŸ“ æ•°æ®å½•å…¥</div>
            <div class="tab" onclick="switchTab(1)">ğŸ”¬ ç‰©ç†éªŒè¯</div>
            <div class="tab" onclick="switchTab(2)">âš¡ èƒ½è€—åˆ†æ</div>
            <div class="tab" onclick="switchTab(3)">ğŸ“Š ç»¼åˆæŠ¥å‘Š</div>
            <div class="tab" onclick="switchTab(4)">ğŸ“ˆ å†å²è®°å½•</div>
        </div>

        <div class="content">
            <!-- æ•°æ®å½•å…¥ -->
            <div class="section active">
                <div class="formula-box">
                    <h4>ğŸ¯ æ•°æ®é‡‡é›†è¯´æ˜</h4>
                    <code>1ï¸âƒ£ è¡¥æ°´å‰ï¼šæ°´æ¸©è¾¾åˆ°é¢„å®šå€¼æ—¶ï¼Œè®°å½•æ‰€æœ‰æ•°æ®</code>
                    <code>2ï¸âƒ£ å¼€å¯è¡¥æ°´é˜€é—¨ï¼Œå¼€å§‹è¡¥æ°´</code>
                    <code>3ï¸âƒ£ è¡¥æ°´åï¼šè¡¥æ°´å®Œæˆæ—¶ï¼Œå†æ¬¡è®°å½•æ‰€æœ‰æ•°æ®</code>
                    <code>4ï¸âƒ£ ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ï¼šå®é™…è¡¥æ°´é‡ã€çœŸå®é€Ÿåº¦ã€å•ä½èƒ½è€—</code>
                </div>

                <div class="dual-panel">
                    <!-- 40å¨å°èƒ½æºç«™ -->
                    <div class="panel small-station">
                        <h3>ğŸŸ¢ 40å¨å°ç«™ï¼ˆåº•é¢ç§¯ 16mÂ²ï¼‰</h3>
                        
                        <div class="input-wrapper full-width">
                            <label>
                                â° è®°å½•æ—¶é—´ <span class="required">*</span> 
                                <span class="temp-badge" id="smallTimeMode">è‡ªåŠ¨æ¨¡å¼</span>
                                <button type="button" onclick="toggleTimeMode('small')" style="padding: 4px 12px; margin-left: 10px; font-size: 12px; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">
                                    ğŸ”„ åˆ‡æ¢æ¨¡å¼
                                </button>
                            </label>
                            <input type="datetime-local" id="smallTime" style="background: #e9ecef;">
                        </div>
                        
                        <div class="section-divider">
                            <h4 style="color: #28a745; margin-bottom: 15px;">ğŸ“ ç‰©ç†æµ‹é‡æ•°æ®</h4>
                        </div>
                        
                        <div class="input-row">
                            <div class="input-wrapper">
                                <label>ğŸ“ å®é™…æ°´ä½é«˜åº¦(cm) <span class="required">*</span></label>
                                <input type="number" id="smallHeight" step="0.1" placeholder="ä»åº•éƒ¨æµ‹é‡">
                            </div>
                            <div class="input-wrapper">
                                <label>ğŸ”¢ æ°´è¡¨è¯»æ•°(å¨) <span class="required">*</span></label>
                                <input type="number" id="smallMeter" step="0.1" placeholder="ç´¯è®¡è¯»æ•°">
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-wrapper">
                                <label>ğŸ“Š æ°´ä½ä¼ æ„Ÿå™¨(%)</label>
                                <input type="number" id="smallLevel" step="0.1" placeholder="æ˜¾ç¤ºå€¼">
                            </div>
                            <div class="input-wrapper">
                                <label>âš¡ è¡¥æ°´é€Ÿåº¦æ˜¾ç¤º(å¨/æ—¶)</label>
                                <input type="number" id="smallSpeed" step="0.1" placeholder="ç³»ç»Ÿæ˜¾ç¤º">
                            </div>
                        </div>

                        <div class="section-divider">
                            <h4 style="color: #ff9800; margin-bottom: 15px;">âš¡ èƒ½è€—ç›¸å…³æ•°æ®</h4>
                        </div>

                        <div class="input-row">
                            <div class="input-wrapper">
                                <label>âš¡ ç”µè¡¨è¯»æ•°(kWh) <span class="required">*</span></label>
                                <input type="number" id="smallElectric" step="0.1" placeholder="ç´¯è®¡ç”¨ç”µé‡">
                            </div>
                            <div class="input-wrapper">
                                <label>ğŸŒ¡ï¸ æ°´ç®±å®é™…æ¸©åº¦(â„ƒ) <span class="required">*</span></label>
                                <input type="number" id="smallWaterTemp" step="0.1" placeholder="å®æµ‹æ°´æ¸©">
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-wrapper">
                                <label>ğŸŒ¡ï¸ ç¯å¢ƒæ¸©åº¦(â„ƒ)</label>
                                <input type="number" id="smallEnvTemp" step="0.1" placeholder="å®¤å¤–æ¸©åº¦">
                            </div>
                            <div class="input-wrapper">
                                <label>ğŸ”„ è®°å½•çŠ¶æ€ <span class="required">*</span></label>
                                <select id="smallStatus">
                                    <option value="è¡¥æ°´å‰">è¡¥æ°´å‰ï¼ˆæ°´æ¸©å·²è¾¾æ ‡ï¼‰</option>
                                    <option value="è¡¥æ°´å">è¡¥æ°´åï¼ˆè¡¥æ°´å®Œæˆï¼‰</option>
                                    <option value="æ—¥å¸¸å·¡æ£€">æ—¥å¸¸å·¡æ£€</option>
                                </select>
                            </div>
                        </div>

                        <div class="input-wrapper full-width">
                            <label>ğŸ“ å¤‡æ³¨</label>
                            <input type="text" id="smallNote" placeholder="å¦‚ï¼šç›®æ ‡æ°´æ¸©60â„ƒ">
                        </div>

                        <div style="margin-top: 20px;">
                            <button class="btn-success" onclick="addRecord('small')">â• æ·»åŠ å°ç«™è®°å½•</button>
                            <button onclick="updateTime('small')" class="btn-info" id="smallRefreshBtn">ğŸ”„ åˆ·æ–°æ—¶é—´</button>
                            <button onclick="clearForm('small')" style="background: #6c757d;">ğŸ—‘ï¸ æ¸…ç©ºè¡¨å•</button>
                        </div>
                    </div>

                    <!-- 120å¨å¤§èƒ½æºç«™ -->
                    <div class="panel large-station">
                        <h3>ğŸ”µ 120å¨å¤§ç«™ï¼ˆåº•é¢ç§¯ 40mÂ²ï¼‰</h3>
                        
                        <div class="input-wrapper full-width">
                            <label>
                                â° è®°å½•æ—¶é—´ <span class="required">*</span> 
                                <span class="temp-badge" id="largeTimeMode">è‡ªåŠ¨æ¨¡å¼</span>
                                <button type="button" onclick="toggleTimeMode('large')" style="padding: 4px 12px; margin-left: 10px; font-size: 12px; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);">
                                    ğŸ”„ åˆ‡æ¢æ¨¡å¼
                                </button>
                            </label>
                            <input type="datetime-local" id="largeTime" style="background: #e9ecef;">
                        </div>
                        
                        <div class="section-divider">
                            <h4 style="color: #007bff; margin-bottom: 15px;">ğŸ“ ç‰©ç†æµ‹é‡æ•°æ®</h4>
                        </div>
                        
                        <div class="input-row">
                            <div class="input-wrapper">
                                <label>ğŸ“ å®é™…æ°´ä½é«˜åº¦(cm) <span class="required">*</span></label>
                                <input type="number" id="largeHeight" step="0.1" placeholder="ä»åº•éƒ¨æµ‹é‡">
                            </div>
                            <div class="input-wrapper">
                                <label>ğŸ”¢ æ°´è¡¨è¯»æ•°(å¨) <span class="required">*</span></label>
                                <input type="number" id="largeMeter" step="0.1" placeholder="ç´¯è®¡è¯»æ•°">
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-wrapper">
                                <label>ğŸ“Š æ°´ä½ä¼ æ„Ÿå™¨(%)</label>
                                <input type="number" id="largeLevel" step="0.1" placeholder="æ˜¾ç¤ºå€¼">
                            </div>
                            <div class="input-wrapper">
                                <label>âš¡ è¡¥æ°´é€Ÿåº¦æ˜¾ç¤º(å¨/æ—¶)</label>
                                <input type="number" id="largeSpeed" step="0.1" placeholder="ç³»ç»Ÿæ˜¾ç¤º">
                            </div>
                        </div>

                        <div class="section-divider">
                            <h4 style="color: #ff9800; margin-bottom: 15px;">âš¡ èƒ½è€—ç›¸å…³æ•°æ®</h4>
                        </div>

                        <div class="input-row">
                            <div class="input-wrapper">
                                <label>âš¡ ç”µè¡¨è¯»æ•°(kWh) <span class="required">*</span></label>
                                <input type="number" id="largeElectric" step="0.1" placeholder="ç´¯è®¡ç”¨ç”µé‡">
                            </div>
                            <div class="input-wrapper">
                                <label>ğŸŒ¡ï¸ æ°´ç®±å®é™…æ¸©åº¦(â„ƒ) <span class="required">*</span></label>
                                <input type="number" id="largeWaterTemp" step="0.1" placeholder="å®æµ‹æ°´æ¸©">
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-wrapper">
                                <label>ğŸŒ¡ï¸ ç¯å¢ƒæ¸©åº¦(â„ƒ)</label>
                                <input type="number" id="largeEnvTemp" step="0.1" placeholder="å®¤å¤–æ¸©åº¦">
                            </div>
                            <div class="input-wrapper">
                                <label>ğŸ”„ è®°å½•çŠ¶æ€ <span class="required">*</span></label>
                                <select id="largeStatus">
                                    <option value="è¡¥æ°´å‰">è¡¥æ°´å‰ï¼ˆæ°´æ¸©å·²è¾¾æ ‡ï¼‰</option>
                                    <option value="è¡¥æ°´å">è¡¥æ°´åï¼ˆè¡¥æ°´å®Œæˆï¼‰</option>
                                    <option value="æ—¥å¸¸å·¡æ£€">æ—¥å¸¸å·¡æ£€</option>
                                </select>
                            </div>
                        </div>

                        <div class="input-wrapper full-width">
                            <label>ğŸ“ å¤‡æ³¨</label>
                            <input type="text" id="largeNote" placeholder="å¦‚ï¼šç›®æ ‡æ°´æ¸©60â„ƒ">
                        </div>

                        <div style="margin-top: 20px;">
                            <button class="btn-success" onclick="addRecord('large')">â• æ·»åŠ å¤§ç«™è®°å½•</button>
                            <button onclick="updateTime('large')" class="btn-info" id="largeRefreshBtn">ğŸ”„ åˆ·æ–°æ—¶é—´</button>
                            <button onclick="clearForm('large')" style="background: #6c757d;">ğŸ—‘ï¸ æ¸…ç©ºè¡¨å•</button>
                        </div>
                    </div>
                </div>

                <div class="alert alert-warning">
                    âš ï¸ <strong>é‡‡é›†è¦æ±‚ï¼š</strong><br>
                    1. <span class="required">*</span> æ ‡è®°ä¸ºå¿…å¡«é¡¹<br>
                    2. è¡¥æ°´å‰ï¼šç¡®ä¿æ°´æ¸©å·²è¾¾åˆ°é¢„å®šå€¼å†è®°å½•<br>
                    3. è¡¥æ°´åï¼šè¡¥æ°´å®Œæˆç«‹å³è®°å½•<br>
                    4. â° <strong>æ—¶é—´æ¨¡å¼ï¼š</strong><br>
                       â€¢ <strong>è‡ªåŠ¨æ¨¡å¼</strong>ï¼ˆé»˜è®¤ï¼‰ï¼šè‡ªåŠ¨è·å–å½“å‰æ—¶é—´ï¼Œé€‚åˆå®æ—¶è®°å½•ï¼Œæ—¶é—´ä¸å¯ä¿®æ”¹<br>
                       â€¢ <strong>æ‰‹åŠ¨æ¨¡å¼</strong>ï¼šå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹æ—¶é—´ï¼Œé€‚åˆäº‹åè¡¥å½•å†å²æ•°æ®<br>
                       â€¢ ç‚¹å‡»"ğŸ”„ åˆ‡æ¢æ¨¡å¼"æŒ‰é’®å¯åœ¨ä¸¤ç§æ¨¡å¼é—´åˆ‡æ¢
                </div>
                
                <button class="btn-warning" onclick="addInitialData()">ğŸ“¥ å¯¼å…¥11æœˆ3æ—¥æµ‹è¯•æ•°æ®</button>
            </div>

            <!-- ç‰©ç†éªŒè¯ -->
            <div class="section">
                <h2>ğŸ”¬ åŸºäºç‰©ç†å®¹é‡çš„è®¾å¤‡éªŒè¯åˆ†æ</h2>
                
                <div class="alert alert-success">
                    âœ… <strong>åˆ†æåŸç†ï¼š</strong>ä»¥ç‰©ç†å®¹é‡ï¼ˆé«˜åº¦Ã—åº•é¢ç§¯ï¼‰ä¸º<span class="highlight-number">ç»å¯¹çœŸå€¼</span>ï¼Œæ ¡éªŒæ°´è¡¨å’Œä¼ æ„Ÿå™¨çš„å‡†ç¡®æ€§
                </div>

                <h3 style="margin-top: 30px;">ğŸŸ¢ 40å¨å°èƒ½æºç«™éªŒè¯ç»“æœ</h3>
                <div class="metric-grid">
                    <div class="metric-card highlight">
                        <h4>ğŸ“ å®é™…è¡¥æ°´å®¹é‡ï¼ˆçœŸå€¼ï¼‰</h4>
                        <div class="metric-value" id="smallPhysicalChange">-</div>
                        <p>é«˜åº¦å˜åŒ– Ã— 16mÂ²</p>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸ”¢ æ°´è¡¨è®¡é‡è¡¥æ°´é‡</h4>
                        <div class="metric-value" id="smallMeterChange">-</div>
                        <p>æ°´è¡¨è¯»æ•°å·®å€¼</p>
                        <span class="deviation-badge" id="smallMeterBadge">-</span>
                    </div>
                    <div class="metric-card">
                        <h4>âš¡ çœŸå®è¡¥æ°´é€Ÿåº¦</h4>
                        <div class="metric-value" id="smallRealSpeed">-</div>
                        <p>å®é™…å®¹é‡ Ã· æ—¶é—´</p>
                        <span class="deviation-badge" id="smallSpeedBadge">-</span>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸ“Š ä¼ æ„Ÿå™¨æ°´ä½å˜åŒ–</h4>
                        <div class="metric-value" id="smallSensorChange">-</div>
                        <p>æ°´ä½%æ˜¾ç¤ºå·®å€¼</p>
                        <span class="deviation-badge" id="smallSensorBadge">-</span>
                    </div>
                </div>

                <div class="result-card">
                    <h3>ğŸŸ¢ 40å¨å°ç«™è¯¦ç»†æ ¡å‡†æ•°æ®</h3>
                    <div class="result-item">
                        <span>â± è¡¥æ°´æ—¶é•¿:</span>
                        <span id="smallDuration">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ“ é«˜åº¦å˜åŒ–:</span>
                        <span id="smallHeightChange">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ’§ å®é™…è¡¥æ°´å®¹é‡:</span>
                        <span id="smallActualVolume" style="color: #28a745;">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ”¢ æ°´è¡¨æ˜¾ç¤ºè¡¥æ°´é‡:</span>
                        <span id="smallMeterVolume">-</span>
                    </div>
                    <div class="result-item">
                        <span>âŒ æ°´è¡¨åå·®:</span>
                        <span id="smallMeterDeviation">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ“Š æ°´è¡¨è¯¯å·®ç‡:</span>
                        <span id="smallMeterErrorRate">-</span>
                    </div>
                    <div class="result-item">
                        <span>âš¡ çœŸå®è¡¥æ°´é€Ÿåº¦:</span>
                        <span id="smallTrueSpeed" style="color: #28a745;">-</span>
                    </div>
                    <div class="result-item">
                        <span>âš¡ æ˜¾ç¤ºè¡¥æ°´é€Ÿåº¦:</span>
                        <span id="smallDisplaySpeed">-</span>
                    </div>
                    <div class="result-item">
                        <span>âŒ é€Ÿåº¦åå·®:</span>
                        <span id="smallSpeedDeviation">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ“Š ä¼ æ„Ÿå™¨è¯¯å·®:</span>
                        <span id="smallSensorError">-</span>
                    </div>
                </div>

                <h3 style="margin-top: 40px;">ğŸ”µ 120å¨å¤§èƒ½æºç«™éªŒè¯ç»“æœ</h3>
                <div class="metric-grid">
                    <div class="metric-card highlight">
                        <h4>ğŸ“ å®é™…è¡¥æ°´å®¹é‡ï¼ˆçœŸå€¼ï¼‰</h4>
                        <div class="metric-value" id="largePhysicalChange">-</div>
                        <p>é«˜åº¦å˜åŒ– Ã— 40mÂ²</p>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸ”¢ æ°´è¡¨è®¡é‡è¡¥æ°´é‡</h4>
                        <div class="metric-value" id="largeMeterChange">-</div>
                        <p>æ°´è¡¨è¯»æ•°å·®å€¼</p>
                        <span class="deviation-badge" id="largeMeterBadge">-</span>
                    </div>
                    <div class="metric-card">
                        <h4>âš¡ çœŸå®è¡¥æ°´é€Ÿåº¦</h4>
                        <div class="metric-value" id="largeRealSpeed">-</div>
                        <p>å®é™…å®¹é‡ Ã· æ—¶é—´</p>
                        <span class="deviation-badge" id="largeSpeedBadge">-</span>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸ“Š ä¼ æ„Ÿå™¨æ°´ä½å˜åŒ–</h4>
                        <div class="metric-value" id="largeSensorChange">-</div>
                        <p>æ°´ä½%æ˜¾ç¤ºå·®å€¼</p>
                        <span class="deviation-badge" id="largeSensorBadge">-</span>
                    </div>
                </div>

                <div class="result-card">
                    <h3>ğŸ”µ 120å¨å¤§ç«™è¯¦ç»†æ ¡å‡†æ•°æ®</h3>
                    <div class="result-item">
                        <span>â± è¡¥æ°´æ—¶é•¿:</span>
                        <span id="largeDuration">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ“ é«˜åº¦å˜åŒ–:</span>
                        <span id="largeHeightChange">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ’§ å®é™…è¡¥æ°´å®¹é‡:</span>
                        <span id="largeActualVolume" style="color: #28a745;">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ”¢ æ°´è¡¨æ˜¾ç¤ºè¡¥æ°´é‡:</span>
                        <span id="largeMeterVolume">-</span>
                    </div>
                    <div class="result-item">
                        <span>âŒ æ°´è¡¨åå·®:</span>
                        <span id="largeMeterDeviation">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ“Š æ°´è¡¨è¯¯å·®ç‡:</span>
                        <span id="largeMeterErrorRate">-</span>
                    </div>
                    <div class="result-item">
                        <span>âš¡ çœŸå®è¡¥æ°´é€Ÿåº¦:</span>
                        <span id="largeTrueSpeed" style="color: #28a745;">-</span>
                    </div>
                    <div class="result-item">
                        <span>âš¡ æ˜¾ç¤ºè¡¥æ°´é€Ÿåº¦:</span>
                        <span id="largeDisplaySpeed">-</span>
                    </div>
                    <div class="result-item">
                        <span>âŒ é€Ÿåº¦åå·®:</span>
                        <span id="largeSpeedDeviation">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ“Š ä¼ æ„Ÿå™¨è¯¯å·®:</span>
                        <span id="largeSensorError">-</span>
                    </div>
                </div>

                <button onclick="analyzePhysical()">ğŸ” å¼€å§‹ç‰©ç†éªŒè¯åˆ†æ</button>
            </div>

            <!-- èƒ½è€—åˆ†æ -->
            <div class="section">
                <h2>âš¡ å•ä½èƒ½è€—åˆ†æ</h2>
                
                <div class="formula-box">
                    <h4>ğŸ”¥ å•ä½èƒ½è€—è®¡ç®—å…¬å¼</h4>
                    <code><strong>å•ä½èƒ½è€—(kWh/å¨)</strong> = (è¡¥æ°´åç”µè¡¨è¯»æ•° - è¡¥æ°´å‰ç”µè¡¨è¯»æ•°) Ã· å®é™…è¡¥æ°´å®¹é‡(å¨)</code>
                    <code><strong>ç†è®ºçƒ­é‡(kWh)</strong> = å®é™…è¡¥æ°´é‡(å¨) Ã— æ¸©å·®(â„ƒ) Ã— 1.163 kWh/(å¨Â·â„ƒ)</code>
                    <code><strong>åŠ çƒ­æ•ˆç‡(%)</strong> = ç†è®ºçƒ­é‡ Ã· å®é™…è€—ç”µé‡ Ã— 100%</code>
                </div>

                <h3 style="margin-top: 30px;">ğŸŸ¢ 40å¨å°èƒ½æºç«™èƒ½è€—åˆ†æ</h3>
                <div class="metric-grid">
                    <div class="metric-card energy-highlight">
                        <h4>âš¡ å•ä½èƒ½è€—</h4>
                        <div class="metric-value" id="smallUnitEnergy">-</div>
                        <p>kWh/å¨</p>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸ”Œ å®é™…è€—ç”µé‡</h4>
                        <div class="metric-value" id="smallEnergyUse">-</div>
                        <p>kWh</p>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸŒ¡ï¸ åŠ çƒ­æ¸©å·®</h4>
                        <div class="metric-value" id="smallTempDiff">-</div>
                        <p>â„ƒ</p>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸ“ˆ åŠ çƒ­æ•ˆç‡</h4>
                        <div class="metric-value" id="smallEfficiency">-</div>
                        <p>%</p>
                        <span class="deviation-badge" id="smallEffBadge">-</span>
                    </div>
                </div>

                <div class="result-card energy">
                    <h3>ğŸŸ¢ 40å¨å°ç«™èƒ½è€—è¯¦ç»†æ•°æ®</h3>
                    <div class="result-item">
                        <span>ğŸ’§ å®é™…è¡¥æ°´é‡:</span>
                        <span id="smallEnergyVolume">-</span>
                    </div>
                    <div class="result-item">
                        <span>âš¡ å®é™…è€—ç”µé‡:</span>
                        <span id="smallActualEnergy" style="color: #e65100;">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ”¥ å•ä½èƒ½è€—:</span>
                        <span id="smallUnitEnergyDetail" style="color: #e65100;">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸŒ¡ï¸ è¡¥æ°´å‰æ¸©åº¦:</span>
                        <span id="smallTempBefore">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸŒ¡ï¸ è¡¥æ°´åæ¸©åº¦:</span>
                        <span id="smallTempAfter">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸŒ¡ï¸ åŠ çƒ­æ¸©å·®:</span>
                        <span id="smallTempDiffDetail">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ§® ç†è®ºéœ€çƒ­é‡:</span>
                        <span id="smallTheoreticalHeat">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ“Š åŠ çƒ­æ•ˆç‡:</span>
                        <span id="smallEfficiencyDetail">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ’° æœ¬æ¬¡ç”µè´¹(0.6å…ƒ/kWh):</span>
                        <span id="smallCost">-</span>
                    </div>
                </div>

                <h3 style="margin-top: 40px;">ğŸ”µ 120å¨å¤§èƒ½æºç«™èƒ½è€—åˆ†æ</h3>
                <div class="metric-grid">
                    <div class="metric-card energy-highlight">
                        <h4>âš¡ å•ä½èƒ½è€—</h4>
                        <div class="metric-value" id="largeUnitEnergy">-</div>
                        <p>kWh/å¨</p>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸ”Œ å®é™…è€—ç”µé‡</h4>
                        <div class="metric-value" id="largeEnergyUse">-</div>
                        <p>kWh</p>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸŒ¡ï¸ åŠ çƒ­æ¸©å·®</h4>
                        <div class="metric-value" id="largeTempDiff">-</div>
                        <p>â„ƒ</p>
                    </div>
                    <div class="metric-card">
                        <h4>ğŸ“ˆ åŠ çƒ­æ•ˆç‡</h4>
                        <div class="metric-value" id="largeEfficiency">-</div>
                        <p>%</p>
                        <span class="deviation-badge" id="largeEffBadge">-</span>
                    </div>
                </div>

                <div class="result-card energy">
                    <h3>ğŸ”µ 120å¨å¤§ç«™èƒ½è€—è¯¦ç»†æ•°æ®</h3>
                    <div class="result-item">
                        <span>ğŸ’§ å®é™…è¡¥æ°´é‡:</span>
                        <span id="largeEnergyVolume">-</span>
                    </div>
                    <div class="result-item">
                        <span>âš¡ å®é™…è€—ç”µé‡:</span>
                        <span id="largeActualEnergy" style="color: #e65100;">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ”¥ å•ä½èƒ½è€—:</span>
                        <span id="largeUnitEnergyDetail" style="color: #e65100;">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸŒ¡ï¸ è¡¥æ°´å‰æ¸©åº¦:</span>
                        <span id="largeTempBefore">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸŒ¡ï¸ è¡¥æ°´åæ¸©åº¦:</span>
                        <span id="largeTempAfter">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸŒ¡ï¸ åŠ çƒ­æ¸©å·®:</span>
                        <span id="largeTempDiffDetail">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ§® ç†è®ºéœ€çƒ­é‡:</span>
                        <span id="largeTheoreticalHeat">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ“Š åŠ çƒ­æ•ˆç‡:</span>
                        <span id="largeEfficiencyDetail">-</span>
                    </div>
                    <div class="result-item">
                        <span>ğŸ’° æœ¬æ¬¡ç”µè´¹(0.6å…ƒ/kWh):</span>
                        <span id="largeCost">-</span>
                    </div>
                </div>

                <button onclick="analyzeEnergy()" class="btn-purple">âš¡ è®¡ç®—å•ä½èƒ½è€—</button>
                <button onclick="compareEnergy()" class="btn-warning">âš–ï¸ åŒç³»ç»Ÿèƒ½è€—å¯¹æ¯”</button>
            </div>

            <!-- ç»¼åˆæŠ¥å‘Š -->
            <div class="section">
                <h2>ğŸ“Š ç»¼åˆéªŒè¯æŠ¥å‘Š</h2>
                
                <div class="alert alert-info">
                    ğŸ’¡ <strong>æŠ¥å‘Šè¯´æ˜ï¼š</strong>æ•´åˆç‰©ç†éªŒè¯å’Œèƒ½è€—åˆ†æï¼Œæä¾›å®Œæ•´çš„è®¾å¤‡æ€§èƒ½è¯„ä¼°
                </div>

                <div class="result-card">
                    <h3>ğŸ“‹ è®¾å¤‡å‡†ç¡®æ€§è¯„ä¼°</h3>
                    <table class="data-table" style="max-height: none;">
                        <thead>
                            <tr>
                                <th>ç³»ç»Ÿ</th>
                                <th>æ°´è¡¨è¯¯å·®ç‡</th>
                                <th>ä¼ æ„Ÿå™¨è¯¯å·®</th>
                                <th>é€Ÿåº¦è¯¯å·®</th>
                                <th>å‡†ç¡®æ€§è¯„çº§</th>
                            </tr>
                        </thead>
                        <tbody id="accuracyReport">
                            <tr><td colspan="5" style="text-align: center; color: #999;">æš‚æ— åˆ†ææ•°æ®</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="result-card energy">
                    <h3>âš¡ èƒ½è€—æ•ˆç‡è¯„ä¼°</h3>
                    <table class="data-table" style="max-height: none;">
                        <thead>
                            <tr>
                                <th>ç³»ç»Ÿ</th>
                                <th>å•ä½èƒ½è€—(kWh/å¨)</th>
                                <th>åŠ çƒ­æ•ˆç‡(%)</th>
                                <th>å¹³å‡æ¸©å·®(â„ƒ)</th>
                                <th>èƒ½æ•ˆè¯„çº§</th>
                            </tr>
                        </thead>
                        <tbody id="energyReport">
                            <tr><td colspan="5" style="text-align: center; color: #999;">æš‚æ— åˆ†ææ•°æ®</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="result-card">
                    <h3>ğŸ¯ ç»Ÿè®¡åŸºç¡€å»ºè®®</h3>
                    <div class="result-item">
                        <span>å®¹é‡ç»Ÿè®¡åŸºå‡†:</span>
                        <span style="color: #28a745;">å®é™…é«˜åº¦ Ã— åº•é¢ç§¯ â­â­â­â­â­</span>
                    </div>
                    <div class="result-item">
                        <span>è¡¥æ°´é‡ç»Ÿè®¡:</span>
                        <span style="color: #28a745;">ç‰©ç†å®¹é‡ï¼ˆç»å¯¹çœŸå€¼ï¼‰</span>
                    </div>
                    <div class="result-item">
                        <span>è¡¥æ°´é€Ÿåº¦ç»Ÿè®¡:</span>
                        <span style="color: #28a745;">å®é™…å®¹é‡ Ã· æ—¶é—´</span>
                    </div>
                    <div class="result-item">
                        <span>èƒ½è€—ç»Ÿè®¡åŸºå‡†:</span>
                        <span style="color: #e65100;">ç”µè¡¨å·®å€¼ Ã· ç‰©ç†å®¹é‡</span>
                    </div>
                    <div class="result-item">
                        <span>æ°´è¡¨ä½¿ç”¨å»ºè®®:</span>
                        <span id="meterAdvice">äº†è§£è¯¯å·®åå¯è¾…åŠ©å‚è€ƒ</span>
                    </div>
                </div>

                <button onclick="generateFullReport()" class="btn-info">ğŸ“„ ç”Ÿæˆå®Œæ•´æŠ¥å‘Š</button>
                <button onclick="exportReport()" class="btn-success">ğŸ“¥ å¯¼å‡ºæŠ¥å‘Š</button>
            </div>

            <!-- å†å²è®°å½• -->
            <div class="section">
                <h2>ğŸ“ˆ å†å²ç›‘æµ‹è®°å½•</h2>
                <div style="margin-bottom: 20px;">
                    <button onclick="filterRecords('all')" class="btn-success">ğŸ“Š æ˜¾ç¤ºå…¨éƒ¨</button>
                    <button onclick="filterRecords('small')">ğŸŸ¢ ä»…å°ç«™</button>
                    <button onclick="filterRecords('large')">ğŸ”µ ä»…å¤§ç«™</button>
                    <button onclick="exportData()" class="btn-info">ğŸ“¥ å¯¼å‡ºCSV</button>
                    <button onclick="document.getElementById('csvFileInput').click()" class="btn-warning">ğŸ“¤ å¯¼å…¥CSV</button>
                    <button onclick="clearHistory()" class="btn-danger">ğŸ—‘ï¸ æ¸…ç©ºè®°å½•</button>
                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="importCSV(event)">
                </div>

                <div class="alert alert-info" id="recordStats">
                    ğŸ“Š ç»Ÿè®¡ï¼šå°ç«™è®°å½• <strong>0</strong> æ¡ | å¤§ç«™è®°å½• <strong>0</strong> æ¡ | æ€»è®¡ <strong>0</strong> æ¡
                </div>

                <div class="alert alert-warning">
                    ğŸ’¡ <strong>CSVå¯¼å…¥è¯´æ˜ï¼š</strong><br>
                    1. å…ˆç‚¹å‡»"ğŸ“¥ å¯¼å‡ºCSV"è·å–æ ‡å‡†æ ¼å¼æ¨¡æ¿<br>
                    2. åœ¨Excelæˆ–æ–‡æœ¬ç¼–è¾‘å™¨ä¸­ä¿®æ­£æ•°æ®<br>
                    3. ä¿å­˜ä¸ºCSVæ ¼å¼ï¼ˆUTF-8ç¼–ç ï¼‰<br>
                    4. ç‚¹å‡»"ğŸ“¤ å¯¼å…¥CSV"é€‰æ‹©ä¿®æ­£åçš„æ–‡ä»¶<br>
                    5. ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿç±»å‹å¹¶å¯¼å…¥æ•°æ®<br>
                    6. <strong>âš ï¸ å¯¼å…¥ä¼šè¦†ç›–ç°æœ‰æ•°æ®ï¼Œè¯·å…ˆå¤‡ä»½ï¼</strong>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ç³»ç»Ÿ</th>
                            <th>è®°å½•æ—¶é—´</th>
                            <th>é«˜åº¦(cm)</th>
                            <th>æ°´è¡¨(å¨)</th>
                            <th>ç”µè¡¨(kWh)</th>
                            <th>æ°´æ¸©(â„ƒ)</th>
                            <th>ç¯å¢ƒæ¸©åº¦</th>
                            <th>æ°´ä½%</th>
                            <th>çŠ¶æ€</th>
                            <th>å¤‡æ³¨</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody">
                        <tr><td colspan="11" style="text-align: center; color: #999;">æš‚æ— å†å²æ•°æ®</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ç³»ç»Ÿé…ç½®
        const SYSTEMS = {
            small: {
                name: '40å¨å°ç«™',
                area: 16,
                nominalCapacity: 40,
                nominalSpeed: 10.5
            },
            large: {
                name: '120å¨å¤§ç«™',
                area: 40,
                nominalCapacity: 120,
                nominalSpeed: 18
            }
        };

        let smallRecords = [];
        let largeRecords = [];
        let currentFilter = 'all';
        
        // æ—¶é—´æ¨¡å¼ç®¡ç†
        let timeMode = {
            small: 'auto',  // 'auto' æˆ– 'manual'
            large: 'auto'
        };

        // åˆå§‹åŒ–
        window.onload = function() {
            loadData();
            updateTime('small');
            updateTime('large');
            updateDisplay();
            // åˆå§‹åŒ–æ—¶é—´æ¨¡å¼
            setTimeMode('small', 'auto');
            setTimeMode('large', 'auto');
        };

        // åˆ‡æ¢æ—¶é—´æ¨¡å¼
        function toggleTimeMode(system) {
            const currentMode = timeMode[system];
            const newMode = currentMode === 'auto' ? 'manual' : 'auto';
            setTimeMode(system, newMode);
            
            const modeText = newMode === 'auto' ? 'å·²åˆ‡æ¢åˆ°è‡ªåŠ¨æ¨¡å¼ï¼ˆå®æ—¶è®°å½•ï¼‰' : 'å·²åˆ‡æ¢åˆ°æ‰‹åŠ¨æ¨¡å¼ï¼ˆå¯è¡¥å½•å†å²æ•°æ®ï¼‰';
            alert(`â° ${modeText}`);
        }

        // è®¾ç½®æ—¶é—´æ¨¡å¼
        function setTimeMode(system, mode) {
            timeMode[system] = mode;
            const timeInput = document.getElementById(system + 'Time');
            const modeBadge = document.getElementById(system + 'TimeMode');
            const refreshBtn = document.getElementById(system + 'RefreshBtn');
            
            if (mode === 'auto') {
                // è‡ªåŠ¨æ¨¡å¼ï¼šåªè¯»ï¼Œç°è‰²èƒŒæ™¯ï¼Œè‡ªåŠ¨åˆ·æ–°å½“å‰æ—¶é—´
                timeInput.readOnly = true;
                timeInput.style.background = '#e9ecef';
                timeInput.style.cursor = 'not-allowed';
                modeBadge.textContent = 'è‡ªåŠ¨æ¨¡å¼';
                modeBadge.style.background = '#17a2b8';
                refreshBtn.style.display = 'inline-block';
                updateTime(system);
            } else {
                // æ‰‹åŠ¨æ¨¡å¼ï¼šå¯ç¼–è¾‘ï¼Œç™½è‰²èƒŒæ™¯
                timeInput.readOnly = false;
                timeInput.style.background = 'white';
                timeInput.style.cursor = 'text';
                modeBadge.textContent = 'æ‰‹åŠ¨æ¨¡å¼';
                modeBadge.style.background = '#ff9800';
                refreshBtn.style.display = 'none';
            }
        }

        // æ›´æ–°å½“å‰æ—¶é—´
        function updateTime(system) {
            // åªæœ‰åœ¨è‡ªåŠ¨æ¨¡å¼ä¸‹æ‰æ›´æ–°æ—¶é—´
            if (timeMode[system] === 'auto') {
                const now = new Date();
                const localTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
                document.getElementById(system + 'Time').value = localTime;
            }
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const sections = document.querySelectorAll('.section');
            
            tabs.forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            
            sections.forEach((section, i) => {
                section.classList.toggle('active', i === index);
            });
        }

        // æ·»åŠ è®°å½•
        function addRecord(system) {
            const record = {
                system: system,
                time: document.getElementById(system + 'Time').value,
                height: parseFloat(document.getElementById(system + 'Height').value),
                meter: parseFloat(document.getElementById(system + 'Meter').value),
                electric: parseFloat(document.getElementById(system + 'Electric').value),
                waterTemp: parseFloat(document.getElementById(system + 'WaterTemp').value),
                envTemp: parseFloat(document.getElementById(system + 'EnvTemp').value) || null,
                level: parseFloat(document.getElementById(system + 'Level').value) || null,
                speed: parseFloat(document.getElementById(system + 'Speed').value) || null,
                status: document.getElementById(system + 'Status').value,
                note: document.getElementById(system + 'Note').value || ''
            };

            // éªŒè¯å¿…å¡«é¡¹
            if (!record.time || isNaN(record.height) || isNaN(record.meter) || isNaN(record.electric) || isNaN(record.waterTemp)) {
                alert('âŒ è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ï¼ˆæ—¶é—´ã€é«˜åº¦ã€æ°´è¡¨ã€ç”µè¡¨ã€æ°´æ¸©ï¼‰ï¼');
                return;
            }

            if (system === 'small') {
                smallRecords.push(record);
            } else {
                largeRecords.push(record);
            }

            saveData();
            updateHistoryTable();
            clearForm(system);
            
            const systemName = system === 'small' ? 'ğŸŸ¢ 40å¨å°ç«™' : 'ğŸ”µ 120å¨å¤§ç«™';
            alert(`âœ… ${systemName}è®°å½•æ·»åŠ æˆåŠŸï¼\nå½“å‰å…±æœ‰ ${system === 'small' ? smallRecords.length : largeRecords.length} æ¡è®°å½•ã€‚`);
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm(system) {
            document.getElementById(system + 'Height').value = '';
            document.getElementById(system + 'Meter').value = '';
            document.getElementById(system + 'Electric').value = '';
            document.getElementById(system + 'WaterTemp').value = '';
            document.getElementById(system + 'EnvTemp').value = '';
            document.getElementById(system + 'Level').value = '';
            document.getElementById(system + 'Speed').value = '';
            document.getElementById(system + 'Note').value = '';
            // æ¸…ç©ºè¡¨å•æ—¶ï¼Œå¦‚æœæ˜¯è‡ªåŠ¨æ¨¡å¼åˆ™æ›´æ–°æ—¶é—´
            if (timeMode[system] === 'auto') {
                updateTime(system);
            }
        }

        // ç‰©ç†éªŒè¯åˆ†æ
        function analyzePhysical() {
            analyzeSystemPhysical('small');
            analyzeSystemPhysical('large');
        }

        function analyzeSystemPhysical(system) {
            const records = system === 'small' ? smallRecords : largeRecords;
            const config = SYSTEMS[system];
            
            if (records.length < 2) {
                alert(`âš ï¸ ${config.name}è‡³å°‘éœ€è¦2æ¡è®°å½•æ‰èƒ½åˆ†æï¼`);
                return;
            }

            const beforeRecords = records.filter(r => r.status === 'è¡¥æ°´å‰');
            const afterRecords = records.filter(r => r.status === 'è¡¥æ°´å');

            if (beforeRecords.length === 0 || afterRecords.length === 0) {
                alert(`âš ï¸ ${config.name}éœ€è¦è‡³å°‘ä¸€æ¡"è¡¥æ°´å‰"å’Œä¸€æ¡"è¡¥æ°´å"è®°å½•ï¼`);
                return;
            }

            const before = beforeRecords[beforeRecords.length - 1];
            const after = afterRecords[afterRecords.length - 1];

            // æ ¸å¿ƒè®¡ç®—
            const heightChange = (after.height - before.height) / 100; // ç±³
            const actualVolume = heightChange * config.area; // å¨
            const meterChange = after.meter - before.meter;
            const levelChange = (after.level || 0) - (before.level || 0);
            
            const timeDiff = (new Date(after.time) - new Date(before.time)) / 3600000; // å°æ—¶
            const realSpeed = actualVolume / timeDiff;
            
            const meterDeviation = meterChange - actualVolume;
            const meterErrorRate = Math.abs(meterDeviation / actualVolume * 100);
            
            const speedDeviation = (after.speed || config.nominalSpeed) - realSpeed;
            
            const actualLevelChange = (actualVolume / config.nominalCapacity) * 100;
            const sensorError = Math.abs(levelChange - actualLevelChange);

            // æ›´æ–°æ˜¾ç¤º
            const prefix = system;
            
            document.getElementById(prefix + 'PhysicalChange').textContent = actualVolume.toFixed(2) + ' å¨';
            document.getElementById(prefix + 'MeterChange').textContent = meterChange.toFixed(2) + ' å¨';
            document.getElementById(prefix + 'RealSpeed').textContent = realSpeed.toFixed(2) + ' å¨/æ—¶';
            document.getElementById(prefix + 'SensorChange').textContent = levelChange.toFixed(1) + '%';
            
            document.getElementById(prefix + 'Duration').textContent = (timeDiff * 60).toFixed(0) + ' åˆ†é’Ÿ';
            document.getElementById(prefix + 'HeightChange').textContent = (heightChange * 100).toFixed(1) + ' cm';
            document.getElementById(prefix + 'ActualVolume').textContent = actualVolume.toFixed(2) + ' å¨';
            document.getElementById(prefix + 'MeterVolume').textContent = meterChange.toFixed(2) + ' å¨';
            document.getElementById(prefix + 'MeterDeviation').textContent = meterDeviation.toFixed(2) + ' å¨';
            document.getElementById(prefix + 'MeterErrorRate').textContent = meterErrorRate.toFixed(2) + '%';
            document.getElementById(prefix + 'TrueSpeed').textContent = realSpeed.toFixed(2) + ' å¨/æ—¶';
            document.getElementById(prefix + 'DisplaySpeed').textContent = (after.speed || config.nominalSpeed).toFixed(1) + ' å¨/æ—¶';
            document.getElementById(prefix + 'SpeedDeviation').textContent = speedDeviation.toFixed(2) + ' å¨/æ—¶';
            document.getElementById(prefix + 'SensorError').textContent = sensorError.toFixed(2) + '%';
            
            setBadge(prefix + 'MeterBadge', meterErrorRate, 'è¯¯å·®' + meterErrorRate.toFixed(1) + '%');
            setBadge(prefix + 'SpeedBadge', Math.abs(speedDeviation/realSpeed*100), 'åå·®' + Math.abs(speedDeviation).toFixed(1));
            setBadge(prefix + 'SensorBadge', sensorError, 'è¯¯å·®' + sensorError.toFixed(1) + '%');
        }

        // èƒ½è€—åˆ†æ
        function analyzeEnergy() {
            analyzeSystemEnergy('small');
            analyzeSystemEnergy('large');
        }

        function analyzeSystemEnergy(system) {
            const records = system === 'small' ? smallRecords : largeRecords;
            const config = SYSTEMS[system];
            
            if (records.length < 2) {
                alert(`âš ï¸ ${config.name}è‡³å°‘éœ€è¦2æ¡è®°å½•æ‰èƒ½åˆ†æèƒ½è€—ï¼`);
                return;
            }

            const beforeRecords = records.filter(r => r.status === 'è¡¥æ°´å‰');
            const afterRecords = records.filter(r => r.status === 'è¡¥æ°´å');

            if (beforeRecords.length === 0 || afterRecords.length === 0) {
                alert(`âš ï¸ ${config.name}éœ€è¦"è¡¥æ°´å‰"å’Œ"è¡¥æ°´å"è®°å½•ï¼`);
                return;
            }

            const before = beforeRecords[beforeRecords.length - 1];
            const after = afterRecords[afterRecords.length - 1];

            // ç‰©ç†å®¹é‡è®¡ç®—
            const heightChange = (after.height - before.height) / 100;
            const actualVolume = heightChange * config.area; // å®é™…è¡¥æ°´é‡ï¼ˆå¨ï¼‰
            
            // èƒ½è€—è®¡ç®—
            const energyUse = after.electric - before.electric; // å®é™…è€—ç”µé‡ï¼ˆkWhï¼‰
            const unitEnergy = energyUse / actualVolume; // å•ä½èƒ½è€—ï¼ˆkWh/å¨ï¼‰
            
            // æ¸©å·®è®¡ç®—
            const tempDiff = after.waterTemp - before.waterTemp; // åŠ çƒ­æ¸©å·®
            
            // ç†è®ºçƒ­é‡è®¡ç®—ï¼šQ = m Ã— c Ã— Î”T
            // æ°´çš„æ¯”çƒ­å®¹ = 4.2 kJ/(kgÂ·â„ƒ) = 1.163 kWh/(å¨Â·â„ƒ)
            const theoreticalHeat = actualVolume * tempDiff * 1.163; // kWh
            
            // åŠ çƒ­æ•ˆç‡
            const efficiency = (theoreticalHeat / energyUse) * 100;
            
            // ç”µè´¹è®¡ç®—ï¼ˆå‡è®¾0.6å…ƒ/kWhï¼‰
            const cost = energyUse * 0.6;

            // æ›´æ–°æ˜¾ç¤º
            const prefix = system;
            
            document.getElementById(prefix + 'UnitEnergy').textContent = unitEnergy.toFixed(2);
            document.getElementById(prefix + 'EnergyUse').textContent = energyUse.toFixed(1);
            document.getElementById(prefix + 'TempDiff').textContent = tempDiff.toFixed(1);
            document.getElementById(prefix + 'Efficiency').textContent = efficiency.toFixed(1);
            
            document.getElementById(prefix + 'EnergyVolume').textContent = actualVolume.toFixed(2) + ' å¨';
            document.getElementById(prefix + 'ActualEnergy').textContent = energyUse.toFixed(1) + ' kWh';
            document.getElementById(prefix + 'UnitEnergyDetail').textContent = unitEnergy.toFixed(2) + ' kWh/å¨';
            document.getElementById(prefix + 'TempBefore').textContent = before.waterTemp.toFixed(1) + ' â„ƒ';
            document.getElementById(prefix + 'TempAfter').textContent = after.waterTemp.toFixed(1) + ' â„ƒ';
            document.getElementById(prefix + 'TempDiffDetail').textContent = tempDiff.toFixed(1) + ' â„ƒ';
            document.getElementById(prefix + 'TheoreticalHeat').textContent = theoreticalHeat.toFixed(1) + ' kWh';
            document.getElementById(prefix + 'EfficiencyDetail').textContent = efficiency.toFixed(1) + '%';
            document.getElementById(prefix + 'Cost').textContent = cost.toFixed(2) + ' å…ƒ';
            
            // æ•ˆç‡å¾½ç« 
            let effBadge = document.getElementById(prefix + 'EffBadge');
            effBadge.textContent = efficiency.toFixed(1) + '%';
            if (efficiency >= 90) {
                effBadge.className = 'deviation-badge deviation-good';
            } else if (efficiency >= 80) {
                effBadge.className = 'deviation-badge deviation-warning';
            } else {
                effBadge.className = 'deviation-badge deviation-danger';
            }
        }

        function compareEnergy() {
            if (smallRecords.length < 2 || largeRecords.length < 2) {
                alert('âš ï¸ ä¸¤ä¸ªç³»ç»Ÿéƒ½éœ€è¦è‡³å°‘2æ¡è®°å½•æ‰èƒ½å¯¹æ¯”ï¼');
                return;
            }

            analyzeEnergy();
            
            const smallUnit = document.getElementById('smallUnitEnergy').textContent;
            const largeUnit = document.getElementById('largeUnitEnergy').textContent;
            const smallEff = document.getElementById('smallEfficiency').textContent;
            const largeEff = document.getElementById('largeEfficiency').textContent;

            alert(`âš–ï¸ åŒç³»ç»Ÿèƒ½è€—å¯¹æ¯”åˆ†æ\n\n` +
                  `ğŸŸ¢ 40å¨å°ç«™ï¼š\n` +
                  `   å•ä½èƒ½è€—: ${smallUnit} kWh/å¨\n` +
                  `   åŠ çƒ­æ•ˆç‡: ${smallEff}%\n\n` +
                  `ğŸ”µ 120å¨å¤§ç«™ï¼š\n` +
                  `   å•ä½èƒ½è€—: ${largeUnit} kWh/å¨\n` +
                  `   åŠ çƒ­æ•ˆç‡: ${largeEff}%\n\n` +
                  `ğŸ’¡ å»ºè®®ï¼šæ•ˆç‡é«˜äº90%ä¸ºä¼˜ç§€ï¼Œ80-90%ä¸ºè‰¯å¥½`);
        }

        // è¾…åŠ©å‡½æ•°
        function setBadge(id, errorRate, text) {
            const badge = document.getElementById(id);
            badge.textContent = text;
            badge.className = 'deviation-badge ' + 
                (errorRate < 2 ? 'deviation-good' : 
                 errorRate < 5 ? 'deviation-warning' : 'deviation-danger');
        }

        // å†å²è®°å½•ç®¡ç†
        function updateHistoryTable() {
            const tbody = document.getElementById('historyBody');
            let records = [];

            if (currentFilter === 'all') {
                records = [...smallRecords.map(r => ({...r, system: 'small'})), 
                          ...largeRecords.map(r => ({...r, system: 'large'}))];
            } else if (currentFilter === 'small') {
                records = smallRecords.map(r => ({...r, system: 'small'}));
            } else {
                records = largeRecords.map(r => ({...r, system: 'large'}));
            }

            records.sort((a, b) => new Date(b.time) - new Date(a.time));

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; color: #999;">æš‚æ— å†å²æ•°æ®</td></tr>';
            } else {
                tbody.innerHTML = records.map((r, i) => {
                    const systemName = r.system === 'small' ? 'ğŸŸ¢ 40å¨å°ç«™' : 'ğŸ”µ 120å¨å¤§ç«™';
                    return `
                        <tr>
                            <td><strong>${systemName}</strong></td>
                            <td>${new Date(r.time).toLocaleString('zh-CN')}</td>
                            <td><strong>${r.height.toFixed(1)}</strong></td>
                            <td>${r.meter.toFixed(1)}</td>
                            <td><strong style="color: #e65100;">${r.electric.toFixed(1)}</strong></td>
                            <td><strong style="color: #17a2b8;">${r.waterTemp.toFixed(1)}â„ƒ</strong></td>
                            <td>${r.envTemp ? r.envTemp.toFixed(1) + 'â„ƒ' : '-'}</td>
                            <td>${r.level ? r.level.toFixed(1) + '%' : '-'}</td>
                            <td><strong>${r.status}</strong></td>
                            <td>${r.note || '-'}</td>
                            <td><button class="delete-btn" onclick="deleteRecord('${r.system}', ${getOriginalIndex(r)})">åˆ é™¤</button></td>
                        </tr>
                    `;
                }).join('');
            }

            document.getElementById('recordStats').innerHTML = 
                `ğŸ“Š ç»Ÿè®¡ï¼šå°ç«™è®°å½• <strong>${smallRecords.length}</strong> æ¡ | å¤§ç«™è®°å½• <strong>${largeRecords.length}</strong> æ¡ | æ€»è®¡ <strong>${smallRecords.length + largeRecords.length}</strong> æ¡`;
        }

        function getOriginalIndex(record) {
            const records = record.system === 'small' ? smallRecords : largeRecords;
            return records.findIndex(r => r.time === record.time && r.height === record.height);
        }

        function deleteRecord(system, index) {
            if (!confirm('âš ï¸ ç¡®å®šåˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return;
            
            if (system === 'small') {
                smallRecords.splice(index, 1);
            } else {
                largeRecords.splice(index, 1);
            }
            
            saveData();
            updateHistoryTable();
        }

        function filterRecords(filter) {
            currentFilter = filter;
            updateHistoryTable();
        }

        // ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
        function generateFullReport() {
            if (smallRecords.length < 2 && largeRecords.length < 2) {
                alert('âš ï¸ æ•°æ®ä¸è¶³ï¼Œæ— æ³•ç”ŸæˆæŠ¥å‘Šï¼');
                return;
            }

            let report = 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n';
            report += 'â•‘   æ°´ç®±ç‰©ç†éªŒè¯ + èƒ½è€—åˆ†æç»¼åˆæŠ¥å‘Š         â•‘\n';
            report += 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            report += `ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\n\n`;
            
            // åˆ†æå°ç«™
            if (smallRecords.length >= 2) {
                const beforeSmall = smallRecords.filter(r => r.status === 'è¡¥æ°´å‰').pop();
                const afterSmall = smallRecords.filter(r => r.status === 'è¡¥æ°´å').pop();
                
                if (beforeSmall && afterSmall) {
                    const heightChange = (afterSmall.height - beforeSmall.height) / 100;
                    const actualVolume = heightChange * 16;
                    const meterChange = afterSmall.meter - beforeSmall.meter;
                    const meterError = Math.abs((meterChange - actualVolume) / actualVolume * 100);
                    
                    const energyUse = afterSmall.electric - beforeSmall.electric;
                    const unitEnergy = energyUse / actualVolume;
                    const tempDiff = afterSmall.waterTemp - beforeSmall.waterTemp;
                    const theoreticalHeat = actualVolume * tempDiff * 1.163;
                    const efficiency = (theoreticalHeat / energyUse) * 100;
                    
                    report += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
                    report += 'ğŸŸ¢ 40å¨å°èƒ½æºç«™åˆ†æç»“æœ\n';
                    report += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
                    
                    report += 'ã€ç‰©ç†éªŒè¯ã€‘\n';
                    report += `  â€¢ å®é™…è¡¥æ°´å®¹é‡ï¼š${actualVolume.toFixed(2)} å¨\n`;
                    report += `  â€¢ æ°´è¡¨æ˜¾ç¤ºè¡¥æ°´é‡ï¼š${meterChange.toFixed(2)} å¨\n`;
                    report += `  â€¢ æ°´è¡¨è¯¯å·®ç‡ï¼š${meterError.toFixed(2)}%\n`;
                    report += `  â€¢ è®¾å¤‡è¯„çº§ï¼š${meterError < 2 ? 'âœ… ä¼˜ç§€' : meterError < 5 ? 'âš ï¸ è‰¯å¥½' : 'âŒ éœ€è¦æ ¡å‡†'}\n\n`;
                    
                    report += 'ã€èƒ½è€—åˆ†æã€‘\n';
                    report += `  â€¢ å®é™…è€—ç”µé‡ï¼š${energyUse.toFixed(1)} kWh\n`;
                    report += `  â€¢ å•ä½èƒ½è€—ï¼š${unitEnergy.toFixed(2)} kWh/å¨\n`;
                    report += `  â€¢ åŠ çƒ­æ¸©å·®ï¼š${tempDiff.toFixed(1)}â„ƒ\n`;
                    report += `  â€¢ åŠ çƒ­æ•ˆç‡ï¼š${efficiency.toFixed(1)}%\n`;
                    report += `  â€¢ æ•ˆç‡è¯„çº§ï¼š${efficiency >= 90 ? 'âœ… ä¼˜ç§€' : efficiency >= 80 ? 'âš ï¸ è‰¯å¥½' : 'âŒ éœ€è¦ä¼˜åŒ–'}\n`;
                    report += `  â€¢ æœ¬æ¬¡ç”µè´¹ï¼š${(energyUse * 0.6).toFixed(2)} å…ƒ\n\n`;
                }
            }
            
            // åˆ†æå¤§ç«™
            if (largeRecords.length >= 2) {
                const beforeLarge = largeRecords.filter(r => r.status === 'è¡¥æ°´å‰').pop();
                const afterLarge = largeRecords.filter(r => r.status === 'è¡¥æ°´å').pop();
                
                if (beforeLarge && afterLarge) {
                    const heightChange = (afterLarge.height - beforeLarge.height) / 100;
                    const actualVolume = heightChange * 40;
                    const meterChange = afterLarge.meter - beforeLarge.meter;
                    const meterError = Math.abs((meterChange - actualVolume) / actualVolume * 100);
                    
                    const energyUse = afterLarge.electric - beforeLarge.electric;
                    const unitEnergy = energyUse / actualVolume;
                    const tempDiff = afterLarge.waterTemp - beforeLarge.waterTemp;
                    const theoreticalHeat = actualVolume * tempDiff * 1.163;
                    const efficiency = (theoreticalHeat / energyUse) * 100;
                    
                    report += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
                    report += 'ğŸ”µ 120å¨å¤§èƒ½æºç«™åˆ†æç»“æœ\n';
                    report += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
                    
                    report += 'ã€ç‰©ç†éªŒè¯ã€‘\n';
                    report += `  â€¢ å®é™…è¡¥æ°´å®¹é‡ï¼š${actualVolume.toFixed(2)} å¨\n`;
                    report += `  â€¢ æ°´è¡¨æ˜¾ç¤ºè¡¥æ°´é‡ï¼š${meterChange.toFixed(2)} å¨\n`;
                    report += `  â€¢ æ°´è¡¨è¯¯å·®ç‡ï¼š${meterError.toFixed(2)}%\n`;
                    report += `  â€¢ è®¾å¤‡è¯„çº§ï¼š${meterError < 2 ? 'âœ… ä¼˜ç§€' : meterError < 5 ? 'âš ï¸ è‰¯å¥½' : 'âŒ éœ€è¦æ ¡å‡†'}\n\n`;
                    
                    report += 'ã€èƒ½è€—åˆ†æã€‘\n';
                    report += `  â€¢ å®é™…è€—ç”µé‡ï¼š${energyUse.toFixed(1)} kWh\n`;
                    report += `  â€¢ å•ä½èƒ½è€—ï¼š${unitEnergy.toFixed(2)} kWh/å¨\n`;
                    report += `  â€¢ åŠ çƒ­æ¸©å·®ï¼š${tempDiff.toFixed(1)}â„ƒ\n`;
                    report += `  â€¢ åŠ çƒ­æ•ˆç‡ï¼š${efficiency.toFixed(1)}%\n`;
                    report += `  â€¢ æ•ˆç‡è¯„çº§ï¼š${efficiency >= 90 ? 'âœ… ä¼˜ç§€' : efficiency >= 80 ? 'âš ï¸ è‰¯å¥½' : 'âŒ éœ€è¦ä¼˜åŒ–'}\n`;
                    report += `  â€¢ æœ¬æ¬¡ç”µè´¹ï¼š${(energyUse * 0.6).toFixed(2)} å…ƒ\n\n`;
                }
            }
            
            report += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            report += 'ğŸ¯ ç»Ÿè®¡åŸºç¡€å»ºè®®\n';
            report += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n';
            report += 'âœ… å®¹é‡ç»Ÿè®¡ï¼šå®é™…é«˜åº¦ Ã— åº•é¢ç§¯ï¼ˆç‰©ç†çœŸå€¼ï¼‰\n';
            report += 'âœ… è¡¥æ°´é‡ç»Ÿè®¡ï¼šä»¥ç‰©ç†å®¹é‡ä¸ºå‡†\n';
            report += 'âœ… è¡¥æ°´é€Ÿåº¦ï¼šå®é™…å®¹é‡ Ã· æ—¶é—´\n';
            report += 'âœ… èƒ½è€—ç»Ÿè®¡ï¼šç”µè¡¨å·®å€¼ Ã· ç‰©ç†å®¹é‡\n';
            report += 'âš ï¸ æ°´è¡¨æ•°æ®ï¼šäº†è§£è¯¯å·®åå¯è¾…åŠ©å‚è€ƒ\n';
            
            alert(report);
        }

        function exportReport() {
            alert('ğŸ“„ æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...\nå»ºè®®å…ˆç‚¹å‡»"ç”Ÿæˆå®Œæ•´æŠ¥å‘Š"å¤åˆ¶æ–‡æœ¬å†…å®¹ã€‚');
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const allRecords = [
                ...smallRecords.map(r => ({...r, system: '40å¨å°ç«™'})),
                ...largeRecords.map(r => ({...r, system: '120å¨å¤§ç«™'}))
            ];

            if (allRecords.length === 0) {
                alert('âš ï¸ æš‚æ— æ•°æ®å¯å¯¼å‡ºï¼');
                return;
            }

            allRecords.sort((a, b) => new Date(a.time) - new Date(b.time));

            let csv = 'ç³»ç»Ÿ,è®°å½•æ—¶é—´,å®é™…é«˜åº¦(cm),æ°´è¡¨è¯»æ•°(å¨),ç”µè¡¨è¯»æ•°(kWh),æ°´æ¸©(â„ƒ),ç¯å¢ƒæ¸©åº¦(â„ƒ),æ°´ä½æ˜¾ç¤º(%),è¡¥æ°´é€Ÿåº¦æ˜¾ç¤º(å¨/æ—¶),çŠ¶æ€,å¤‡æ³¨\n';
            allRecords.forEach(r => {
                csv += `${r.system},${r.time},${r.height},${r.meter},${r.electric},${r.waterTemp},${r.envTemp || ''},${r.level || ''},${r.speed || ''},${r.status},"${r.note || ''}"\n`;
            });

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `æ°´ç®±ç»¼åˆç›‘æµ‹æ•°æ®_${new Date().toISOString().slice(0,10)}.csv`;
            link.click();

            alert('âœ… æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
        }

        function clearHistory() {
            if (!confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;

            smallRecords = [];
            largeRecords = [];
            saveData();
            updateHistoryTable();
            alert('âœ… å†å²è®°å½•å·²æ¸…ç©º');
        }

        // å¯¼å…¥åˆå§‹æ•°æ®
        function addInitialData() {
            if (!confirm('å¯¼å…¥11æœˆ3æ—¥çš„å®Œæ•´æµ‹è¯•æ•°æ®ï¼ˆå«èƒ½è€—æ•°æ®ï¼‰ï¼Ÿ')) return;

            // 40å¨å°ç«™æ•°æ®
            smallRecords.push({
                system: 'small',
                time: '2024-11-03T09:32',
                height: 69,
                meter: 989.7,
                electric: 1500.0,
                waterTemp: 58.0,
                envTemp: 12.0,
                level: 16,
                speed: 10.5,
                status: 'è¡¥æ°´å‰',
                note: '11æœˆ3æ—¥æµ‹è¯•-è¡¥æ°´å‰'
            });

            smallRecords.push({
                system: 'small',
                time: '2024-11-03T10:12',
                height: 122,
                meter: 1001,
                electric: 1520.5,
                waterTemp: 60.0,
                envTemp: 12.0,
                level: 45,
                speed: 10.5,
                status: 'è¡¥æ°´å',
                note: '11æœˆ3æ—¥æµ‹è¯•-è¡¥æ°´å'
            });

            // 120å¨å¤§ç«™æ•°æ®
            largeRecords.push({
                system: 'large',
                time: '2024-11-03T09:30',
                height: 81,
                meter: 4081,
                electric: 8500.0,
                waterTemp: 55.0,
                envTemp: 12.0,
                level: 21,
                speed: 18,
                status: 'è¡¥æ°´å‰',
                note: '11æœˆ3æ—¥æµ‹è¯•-è¡¥æ°´å‰'
            });

            largeRecords.push({
                system: 'large',
                time: '2024-11-03T09:57',
                height: 132,
                meter: 4094,
                electric: 8558.0,
                waterTemp: 58.5,
                envTemp: 12.0,
                level: 37,
                speed: 18,
                status: 'è¡¥æ°´å',
                note: '11æœˆ3æ—¥æµ‹è¯•-è¡¥æ°´å'
            });

            saveData();
            updateHistoryTable();
            alert('âœ… å®Œæ•´æµ‹è¯•æ•°æ®å¯¼å…¥æˆåŠŸï¼\n\nå·²å¯¼å…¥ï¼š\nâ€¢ 40å¨å°ç«™ï¼š2æ¡è®°å½•ï¼ˆå«èƒ½è€—ï¼‰\nâ€¢ 120å¨å¤§ç«™ï¼š2æ¡è®°å½•ï¼ˆå«èƒ½è€—ï¼‰\n\nç°åœ¨å¯ä»¥ï¼š\n1. åˆ‡æ¢åˆ°"ç‰©ç†éªŒè¯"åˆ†æè®¾å¤‡å‡†ç¡®æ€§\n2. åˆ‡æ¢åˆ°"èƒ½è€—åˆ†æ"è®¡ç®—å•ä½èƒ½è€—\n3. æŸ¥çœ‹"ç»¼åˆæŠ¥å‘Š"äº†è§£å®Œæ•´è¯„ä¼°');
        }

        function updateDisplay() {
            updateHistoryTable();
        }

        // æ•°æ®æŒä¹…åŒ–
        function saveData() {
            const data = {
                smallRecords,
                largeRecords
            };
            localStorage.setItem('waterTankData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('waterTankData');
            if (saved) {
                const data = JSON.parse(saved);
                smallRecords = data.smallRecords || [];
                largeRecords = data.largeRecords || [];
                updateHistoryTable();
            }
        }

        // è‡ªåŠ¨åˆ·æ–°æ—¶é—´ï¼ˆæ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ï¼Œä½†åªåœ¨è‡ªåŠ¨æ¨¡å¼ä¸‹ï¼‰
        setInterval(() => {
            if (timeMode.small === 'auto') {
                updateTime('small');
            }
            if (timeMode.large === 'auto') {
                updateTime('large');
            }
        }, 60000);
    </script>
</body>
</html>
                        